# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0
PortGroup               xcode 1.0

github.setup            lukas-zronek ssh-askpass-mac 3.0 v

categories              aqua
license                 BSD
maintainers             {@sstallion gmail.com:sstallion} openmaintainer

description             A macOS front-end of ssh-askpass with keychain support
long_description        ssh-askpass-mac is a graphical front-end for ssh-add on macOS, which can \
                        store the password of a private key in the keychain

use_xcode               yes

github.tarball_from     archive
distname                v${version}

checksums               rmd160  5c06ca70e677b88f54bb67a70f206df69c9135ef \
                        sha256  022ba09310c6165e33b8e60aa3ef512498e47f51b3fb34b350989f75f007224d \
                        size    21651

post-destroot {
    xinstall -d -m 0755 ${destroot}${prefix}/Library/LaunchAgents
    xinstall -m 0644 ${filespath}/org.macports.ssh-askpass-mac.plist \
        ${destroot}${prefix}/Library/LaunchAgents
    reinplace "s|@APPLICATIONS_DIR@|${applications_dir}|g" \
        ${destroot}${prefix}/Library/LaunchAgents/org.macports.ssh-askpass-mac.plist

    if {${startupitem.install} && [geteuid] == 0} {
        xinstall -d -m 0755 ${destroot}/Library/LaunchAgents
        ln -s ${prefix}/Library/LaunchAgents/org.macports.ssh-askpass-mac.plist ${destroot}/Library/LaunchAgents
    }
}

notes "
Launch ${name} with
    launchctl load -w \\
        /Library/LaunchAgents/org.macports.ssh-askpass-mac.plist

On macOS < 12 (Monterey) or OpenSSH < 8.4 add the following line to the startup
file of your shell (~/.bash_profile (bash) or ~/.zprofile (zsh)):

    ssh-add()
    {
        command ssh-add $@ </dev/null
    }

The setting 'Remember passphrase in my keychain' is enabled by default. A
change of the setting is retained. You can also disable the keychain with the
following command:

    defaults write at.zronek.lukas.ssh-askpass useKeychain -bool false
"

startupitem.install     yes
startupitem.location    LaunchAgents
